# UniAD ä»£ç å­¦ä¹ æŒ‡å—

æœ¬æŒ‡å—æ—¨åœ¨å¸®åŠ©å¼€å‘è€…æ·±å…¥ç†è§£ UniAD å¼‚å¸¸æ£€æµ‹æ¡†æ¶çš„ä»£ç å®ç°å’Œæ ¸å¿ƒåŸç†ã€‚

## ğŸ“š æ–‡æ¡£å¯¼èˆª

### åŸºç¡€éƒ¨åˆ†
- **[éƒ¨ç½²æ–‡æ¡£](DEPLOYMENT_CN.md)** - ç¯å¢ƒé…ç½®ã€æ•°æ®é›†å‡†å¤‡ã€è®­ç»ƒéƒ¨ç½²æµç¨‹

### æ¶æ„æ¨¡å—
- **[æ•´ä½“æ¶æ„](architecture/ARCHITECTURE.md)** - é¡¹ç›®æ¶æ„è®¾è®¡ã€ä¸‰å±‚ç»“æ„ã€æ•°æ®æµç¨‹
- **[æ¨¡å‹è¯¦è§£](architecture/MODELS.md)** - Backboneã€Neckã€Reconstructionæ¨¡å—æ·±åº¦è§£æ
- **[æ•°æ®å¤„ç†](architecture/DATASETS.md)** - æ•°æ®é›†åŠ è½½ã€é¢„å¤„ç†ã€æ•°æ®å¢å¼º

### è®­ç»ƒæ¨¡å—
- **[è®­ç»ƒæµç¨‹](training/TRAINING.md)** - è®­ç»ƒä¸»æµç¨‹ã€é…ç½®æ–‡ä»¶ã€æŸå¤±å‡½æ•°ã€ä¼˜åŒ–å™¨
- **[è¯„ä¼°å¯è§†åŒ–](training/EVALUATION.md)** - è¯„ä¼°æŒ‡æ ‡ã€å¯è§†åŒ–å·¥å…·ã€ç»“æœåˆ†æ

### è¿›é˜¶å†…å®¹
- **[è¿›é˜¶å®è·µ](advanced/ADVANCED.md)** - è‡ªå®šä¹‰æ•°æ®é›†ã€ä¿®æ”¹ç½‘ç»œã€è°ƒè¯•æŠ€å·§ã€æ€§èƒ½ä¼˜åŒ–

## ğŸ¯ å­¦ä¹ è·¯å¾„

### åˆå­¦è€…è·¯å¾„
1. **ç¯å¢ƒæ­å»º** â†’ [éƒ¨ç½²æ–‡æ¡£](DEPLOYMENT_CN.md)
2. **ç†è§£æ¶æ„** â†’ [æ•´ä½“æ¶æ„](architecture/ARCHITECTURE.md)
3. **è¿è¡Œè®­ç»ƒ** â†’ [è®­ç»ƒæµç¨‹](training/TRAINING.md)
4. **æŸ¥çœ‹ç»“æœ** â†’ [è¯„ä¼°å¯è§†åŒ–](training/EVALUATION.md)

### ç ”ç©¶è€…è·¯å¾„
1. **æ¶æ„è®¾è®¡** â†’ [æ•´ä½“æ¶æ„](architecture/ARCHITECTURE.md)
2. **æ¨¡å‹åŸç†** â†’ [æ¨¡å‹è¯¦è§£](architecture/MODELS.md)
3. **æ•°æ®å¤„ç†** â†’ [æ•°æ®å¤„ç†](architecture/DATASETS.md)
4. **è®­ç»ƒç»†èŠ‚** â†’ [è®­ç»ƒæµç¨‹](training/TRAINING.md)
5. **å®éªŒåˆ†æ** â†’ [è¯„ä¼°å¯è§†åŒ–](training/EVALUATION.md)

### å¼€å‘è€…è·¯å¾„
1. **å¿«é€Ÿä¸Šæ‰‹** â†’ [éƒ¨ç½²æ–‡æ¡£](DEPLOYMENT_CN.md)
2. **ä»£ç æ¶æ„** â†’ [æ•´ä½“æ¶æ„](architecture/ARCHITECTURE.md)
3. **æ ¸å¿ƒæ¨¡å—** â†’ [æ¨¡å‹è¯¦è§£](architecture/MODELS.md)
4. **è‡ªå®šä¹‰å¼€å‘** â†’ [è¿›é˜¶å®è·µ](advanced/ADVANCED.md)

## ğŸ“– é¡¹ç›®æ¦‚è¿°

### ä»€ä¹ˆæ˜¯ UniADï¼Ÿ

UniAD (Unified Anomaly Detection) æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„å¤šç±»åˆ«å¼‚å¸¸æ£€æµ‹æ¡†æ¶ï¼Œå‘è¡¨äº NeurIPS 2022ã€‚å®ƒèƒ½å¤Ÿï¼š

- ä½¿ç”¨å•ä¸€æ¨¡å‹å¤„ç†å¤šä¸ªç±»åˆ«çš„å¼‚å¸¸æ£€æµ‹
- æ— éœ€ä¸ºæ¯ä¸ªç±»åˆ«å•ç‹¬è®­ç»ƒæ¨¡å‹
- æ”¯æŒå·¥ä¸šç¼ºé™·æ£€æµ‹ï¼ˆMVTec-ADï¼‰å’Œå›¾åƒå¼‚å¸¸æ£€æµ‹ï¼ˆCIFAR-10ï¼‰

### æ ¸å¿ƒæ€æƒ³

**ç‰¹å¾é‡å»º + Transformer**ï¼š
- ä½¿ç”¨é¢„è®­ç»ƒçš„éª¨å¹²ç½‘ç»œæå–ç‰¹å¾
- é€šè¿‡ Transformer é‡å»ºæ­£å¸¸æ ·æœ¬çš„ç‰¹å¾
- é‡å»ºè¯¯å·®ä½œä¸ºå¼‚å¸¸åˆ†æ•°

**å…³é”®æŠ€æœ¯**ï¼š
- Feature Jitterï¼šè®­ç»ƒæ—¶å¯¹ç‰¹å¾æ·»åŠ æ‰°åŠ¨ï¼Œå¢å¼ºé²æ£’æ€§
- Neighbor Maskï¼šé™åˆ¶è‡ªæ³¨æ„åŠ›çš„é‚»åŸŸèŒƒå›´ï¼Œä¿æŒå±€éƒ¨æ€§
- ä½ç½®ç¼–ç ï¼šä¸ºç‰¹å¾æ·»åŠ ç©ºé—´ä½ç½®ä¿¡æ¯

### ä»£ç ç»“æ„

```
UniAD/
â”œâ”€â”€ models/                    # æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ backbones/            # éª¨å¹²ç½‘ç»œï¼ˆResNetã€EfficientNetï¼‰
â”‚   â”œâ”€â”€ necks/                # ç‰¹å¾èåˆï¼ˆMFCNï¼‰
â”‚   â””â”€â”€ reconstructions/      # é‡å»ºç½‘ç»œï¼ˆUniADã€Transformerï¼‰
â”œâ”€â”€ datasets/                  # æ•°æ®é›†åŠ è½½
â”‚   â”œâ”€â”€ custom_dataset.py     # MVTec-ADæ•°æ®é›†
â”‚   â”œâ”€â”€ cifar_dataset.py      # CIFAR-10æ•°æ®é›†
â”‚   â””â”€â”€ transforms.py         # æ•°æ®å¢å¼º
â”œâ”€â”€ tools/                     # è®­ç»ƒè¯„ä¼°å·¥å…·
â”‚   â””â”€â”€ train_val.py          # è®­ç»ƒä¸»è„šæœ¬
â”œâ”€â”€ utils/                     # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ eval_helper.py        # è¯„ä¼°å·¥å…·
â”‚   â”œâ”€â”€ vis_helper.py         # å¯è§†åŒ–å·¥å…·
â”‚   â””â”€â”€ misc_helper.py        # è¾…åŠ©å‡½æ•°
â””â”€â”€ experiments/               # å®éªŒé…ç½®
    â”œâ”€â”€ MVTec-AD/             # MVTec-ADå®éªŒ
    â””â”€â”€ CIFAR-10/             # CIFAR-10å®éªŒ
```

## ğŸ” å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒé…ç½®

```bash
# åˆ›å»ºç¯å¢ƒ
conda create -n uniad python=3.8
conda activate uniad

# å®‰è£…PyTorch
pip install torch==1.8.1+cu111 torchvision==0.9.1+cu111 -f https://download.pytorch.org/whl/torch_stable.html

# å®‰è£…ä¾èµ–
pip install einops opencv-python Pillow PyYAML scikit-learn scipy tabulate tensorboardX easydict
pip install protobuf==3.20.3
```

è¯¦è§ [éƒ¨ç½²æ–‡æ¡£](DEPLOYMENT_CN.md)

### 2. è¿è¡Œè®­ç»ƒ

```bash
cd experiments/MVTec-AD
bash train_torch.sh 1 0
```

### 3. æŸ¥çœ‹æ—¥å¿—

```bash
tail -f log/train.log
```

## ğŸ“Š æ•°æ®é›†

### MVTec-AD
å·¥ä¸šå¼‚å¸¸æ£€æµ‹æ•°æ®é›†ï¼ŒåŒ…å«15ä¸ªç‰©ä½“ç±»åˆ«çš„æ­£å¸¸å’Œå¼‚å¸¸æ ·æœ¬ã€‚

**ä¸‹è½½**: https://www.mvtec.com/company/research/datasets/mvtec-ad

### CIFAR-10
å›¾åƒåˆ†ç±»æ•°æ®é›†ï¼Œæ”¹é€ ç”¨äºå¼‚å¸¸æ£€æµ‹ï¼ˆå°†éƒ¨åˆ†ç±»åˆ«ä½œä¸ºæ­£å¸¸ï¼Œå…¶ä»–ä½œä¸ºå¼‚å¸¸ï¼‰ã€‚

**ä¸‹è½½**: https://www.cs.toronto.edu/~kriz/cifar.html

## ğŸ“ æ ¸å¿ƒæ¦‚å¿µ

### 1. ä¸‰å±‚æ¶æ„

```
è¾“å…¥å›¾åƒ â†’ Backbone â†’ Neck â†’ Reconstruction â†’ é‡å»ºç‰¹å¾ â†’ å¼‚å¸¸åˆ†æ•°
```

- **Backbone**: æå–å›¾åƒç‰¹å¾ï¼ˆResNetã€EfficientNetï¼‰
- **Neck**: èåˆå¤šå°ºåº¦ç‰¹å¾ï¼ˆMFCNï¼‰
- **Reconstruction**: é‡å»ºæ­£å¸¸ç‰¹å¾ï¼ˆUniAD Transformerï¼‰

### 2. Transformer é‡å»º

```python
# ä¼ªä»£ç 
features = backbone(image)              # ç‰¹å¾æå–
features = neck(features)               # ç‰¹å¾èåˆ
queries = learnable_queries             # å¯å­¦ä¹ çš„æŸ¥è¯¢å‘é‡
reconstructed = transformer(queries, features)  # Transformeré‡å»º
loss = MSE(features, reconstructed)     # é‡å»ºæŸå¤±
```

### 3. å¼‚å¸¸æ£€æµ‹æµç¨‹

**è®­ç»ƒé˜¶æ®µ**ï¼š
1. åªä½¿ç”¨æ­£å¸¸æ ·æœ¬è®­ç»ƒ
2. å­¦ä¹ é‡å»ºæ­£å¸¸æ ·æœ¬çš„ç‰¹å¾
3. æœ€å°åŒ–é‡å»ºè¯¯å·®

**æµ‹è¯•é˜¶æ®µ**ï¼š
1. å¯¹æµ‹è¯•æ ·æœ¬è¿›è¡Œç‰¹å¾é‡å»º
2. è®¡ç®—é‡å»ºè¯¯å·®
3. é«˜è¯¯å·® = å¼‚å¸¸ï¼Œä½è¯¯å·® = æ­£å¸¸

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### è®­ç»ƒ
```bash
# MVTec-AD
cd experiments/MVTec-AD
bash train_torch.sh 1 0

# CIFAR-10
cd experiments/CIFAR-10/01234
bash train_torch.sh 1 0
```

### è¯„ä¼°
```bash
cd experiments/MVTec-AD
bash eval_torch.sh 1 0
```

### å¯è§†åŒ–
```bash
# æŸ¥çœ‹é‡å»ºç»“æœ
python tools/vis_recon.py --config experiments/MVTec-AD/config.yaml

# æŸ¥çœ‹æŸ¥è¯¢å‘é‡
python tools/vis_query.py --config experiments/MVTec-AD/config.yaml
```

## ğŸ“ è®ºæ–‡å¼•ç”¨

```bibtex
@inproceedings{you2022unified,
  title={A Unified Model for Multi-class Anomaly Detection},
  author={You, Zhiyuan and Cui, Lei and Shen, Yujun and Yang, Kai and Lu, Xin and Zheng, Yu and Le, Xinyi},
  booktitle={NeurIPS},
  year={2022}
}
```

## ğŸ”— ç›¸å…³èµ„æº

- **åŸå§‹é¡¹ç›®**: https://github.com/zhiyuanyou/UniAD
- **æœ¬é¡¹ç›®**: https://github.com/Forward233/uniad-anomaly-detection
- **è®ºæ–‡**: https://arxiv.org/abs/2206.03687

## ğŸ’¡ å­¦ä¹ å»ºè®®

1. **å…ˆè¿è¡Œå†ç†è§£**ï¼šå…ˆæˆåŠŸè¿è¡Œè®­ç»ƒï¼Œè§‚å¯Ÿè¾“å‡ºï¼Œå†æ·±å…¥ä»£ç 
2. **æ¨¡å—åŒ–å­¦ä¹ **ï¼šæŒ‰ç…§æ¶æ„â†’æ•°æ®â†’è®­ç»ƒâ†’è¯„ä¼°çš„é¡ºåºå­¦ä¹ 
3. **å®éªŒå¯¹æ¯”**ï¼šå°è¯•ä¸åŒå‚æ•°é…ç½®ï¼Œè§‚å¯Ÿç»“æœå˜åŒ–
4. **ä»£ç è°ƒè¯•**ï¼šä½¿ç”¨IDEæ–­ç‚¹è°ƒè¯•ï¼Œç†è§£æ•°æ®æµå‘
5. **é˜…è¯»è®ºæ–‡**ï¼šç»“åˆè®ºæ–‡ç†è§£ä»£ç å®ç°ç»†èŠ‚

## â“ å¸¸è§é—®é¢˜

### Q: è®­ç»ƒéœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ
A: MVTec-ADçº¦12-13å°æ—¶ï¼ˆ1000 epochsï¼‰ï¼Œä½†é€šå¸¸100-300 epochså³å¯è¾¾åˆ°è¾ƒå¥½æ•ˆæœã€‚

### Q: æ˜¾å­˜ä¸è¶³æ€ä¹ˆåŠï¼Ÿ
A: å‡å°batch_sizeæˆ–input_sizeï¼Œå‚è€ƒ[éƒ¨ç½²æ–‡æ¡£](DEPLOYMENT_CN.md)ç¬¬7.4èŠ‚ã€‚

### Q: å¦‚ä½•æ·»åŠ è‡ªå·±çš„æ•°æ®é›†ï¼Ÿ
A: å‚è€ƒ[è¿›é˜¶å®è·µ](advanced/ADVANCED.md)ä¸­çš„è‡ªå®šä¹‰æ•°æ®é›†ç« èŠ‚ã€‚

### Q: å¦‚ä½•ç†è§£Feature Jitterï¼Ÿ
A: å‚è€ƒ[æ¨¡å‹è¯¦è§£](architecture/MODELS.md)ä¸­çš„Feature Jitterç« èŠ‚ã€‚

---

**å¼€å§‹å­¦ä¹ **ï¼šå»ºè®®ä» [æ•´ä½“æ¶æ„](architecture/ARCHITECTURE.md) å¼€å§‹ï¼Œäº†è§£é¡¹ç›®çš„æ•´ä½“è®¾è®¡æ€è·¯ã€‚
